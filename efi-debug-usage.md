# EFI Shell 调试脚本使用说明

## 文件说明
- `efi-debug-script.nsh` - EFI Shell 可执行脚本
- `efi-debug-commands.txt` - 手动命令参考

## 使用方法

### 1. 准备工作
1. 将 `efi-debug-script.nsh` 复制到 U 盘根目录
2. 确保 U 盘已插入计算机
3. 启动到 EFI Shell

### 2. 执行脚本
在 EFI Shell 中执行：
```bash
# 切换到 U 盘（通常是 fs0:）
fs0:

# 执行调试脚本
efi-debug-script.nsh
```

### 3. 收集的信息
脚本会自动收集所有信息到一个统一的报告文件：

**主要输出文件**：
- `efi-debug-report.txt` - **统一调试报告**（包含所有信息）

**报告内容结构**：
1. 设备信息（设备和驱动列表）
2. 设备重新连接状态
3. 网络接口信息
4. 网络连通性测试
5. 文件系统映射
6. iPXE 文件搜索
7. 启动配置信息
8. 内存映射信息
9. PCI 设备列表
10. EFI 变量信息
11. iPXE 启动测试
12. 调试总结

### 4. 分析结果
1. 将 U 盘连接到其他计算机
2. 打开 `debug/efi-debug-report.txt` 文件
3. 重点关注以下部分：
   - **第6部分** - iPXE 文件搜索：是否找到 iPXE 文件
   - **第11部分** - iPXE 启动测试：启动是否成功
   - **第3部分** - 网络接口信息：网卡是否被识别
   - **第7部分** - 启动配置信息：启动菜单配置

## 故障排除

### 如果脚本执行失败
1. 检查 U 盘是否被识别：`map -r`
2. 确认脚本文件权限：`ls -l fs0:\efi-debug-script.nsh`
3. 手动执行单个命令进行调试

### 如果找不到 iPXE 文件
1. 检查 ROM 是否正确刷入
2. 使用 `cbfstool` 验证 ROM 内容
3. 查看报告第6部分 - iPXE 文件搜索结果

### 如果网络不工作
1. 检查网卡驱动是否加载：查看报告第1.2部分 - 驱动信息
2. 检查网络接口状态：查看报告第3部分 - 网络接口信息
3. 查看报告第4部分 - 网络连通性测试结果
