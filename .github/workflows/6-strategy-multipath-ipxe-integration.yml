name: æ–¹æ¡ˆ6 - å¤šè·¯å¾„ iPXE é›†æˆ / Strategy 6 - Multi-path iPXE Integration

on:
  workflow_dispatch:
    inputs:
      release:
        description: "åˆ›å»º Release å‘å¸ƒ / Create Release"
        required: false
        type: boolean
        default: false

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ æ˜¾ç¤ºæ–¹æ¡ˆä¿¡æ¯ / Display Strategy Info
        run: |
          echo "=========================================="
          echo "ğŸ¯ æ–¹æ¡ˆ6ï¼šå¤šè·¯å¾„ iPXE é›†æˆ"
          echo "=========================================="
          echo ""
          echo "ğŸ“ æ–¹æ¡ˆè¯´æ˜ï¼š"
          echo "  - å°è¯•å¤šä¸ª CBFS è·¯å¾„é›†æˆ iPXE"
          echo "  - æµ‹è¯•ä¸åŒå‹ç¼©æ–¹å¼çš„å½±å“"
          echo "  - æ‰¾åˆ°æœ€å¯é çš„é›†æˆæ–¹æ³•"
          echo ""
          echo "ğŸ¯ é¢„æœŸç»“æœï¼š"
          echo "  âœ… æ‰¾åˆ°æœ€å¯é çš„ iPXE é›†æˆè·¯å¾„"
          echo "  âœ… ç¡®å®šæœ€ä½³å‹ç¼©ç­–ç•¥"
          echo "  âœ… æé«˜ iPXE åœ¨å¯åŠ¨èœå•ä¸­çš„å¯è§æ€§"
          echo ""
          echo "ğŸ“Š æŠ€æœ¯å®ç°ï¼š"
          echo "  1. é…ç½® EDK2 ç½‘ç»œæ”¯æŒ"
          echo "  2. ä¸‹è½½é¢„ç¼–è¯‘ iPXE EFI"
          echo "  3. ç¼–è¯‘ MrChromebox å›ºä»¶"
          echo "  4. å°è¯•å¤šç§é›†æˆè·¯å¾„å’Œå‹ç¼©æ–¹å¼"
          echo "  5. å¯¹æ¯”é›†æˆæˆåŠŸç‡"
          echo "=========================================="

      - name: æ£€å‡ºæ„å»ºä»“åº“ / Checkout Builder Repository
        uses: actions/checkout@v4

      - name: æ‹‰å– Coreboot SDK å®¹å™¨ / Pull Coreboot SDK
        run: docker pull coreboot/coreboot-sdk:latest

      - name: å…‹éš† MrChromebox Coreboot æºç  / Clone Coreboot Source
        run: |
          echo "ğŸ“¥ å…‹éš† MrChromebox coreboot"
          git clone https://github.com/MrChromebox/coreboot.git coreboot
          cd coreboot
          git submodule update --init --checkout --recursive

      - name: é…ç½® EDK2 ç½‘ç»œæ”¯æŒ / Configure EDK2 Network Support
        run: |
          echo "ğŸ“ é…ç½® MrChromebox kaisa ç½‘ç»œæ”¯æŒ"
          cd coreboot
          
          # æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ -f "configs/cml/config.kaisa.uefi" ]; then
            echo "âœ… æ‰¾åˆ°ç°æœ‰é…ç½®æ–‡ä»¶"
            
            # æ£€æŸ¥æ˜¯å¦å·²åŒ…å«ç½‘ç»œæ”¯æŒé…ç½®
            if grep -q "CONFIG_EDK2_NETWORK_PXE_SUPPORT=y" configs/cml/config.kaisa.uefi; then
              echo "âœ… EDK2 ç½‘ç»œæ”¯æŒé…ç½®å·²å­˜åœ¨"
            else
              echo "ğŸ“ æ·»åŠ  EDK2 ç½‘ç»œæ”¯æŒé…ç½®"
              echo "" >> configs/cml/config.kaisa.uefi
              echo "# EDK2 ç½‘ç»œæ”¯æŒé…ç½®ï¼ˆæ–¹æ¡ˆ6ï¼šå¤šè·¯å¾„ iPXE é›†æˆï¼‰" >> configs/cml/config.kaisa.uefi
              echo "CONFIG_EDK2_NETWORK_PXE_SUPPORT=y" >> configs/cml/config.kaisa.uefi
              echo "CONFIG_EDK2_NETWORK_HTTP_BOOT_SUPPORT=y" >> configs/cml/config.kaisa.uefi
              echo "CONFIG_EDK2_NETWORK_ISCSI_SUPPORT=y" >> configs/cml/config.kaisa.uefi
              echo "âœ… EDK2 ç½‘ç»œæ”¯æŒé…ç½®å·²æ·»åŠ "
            fi
          else
            echo "âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨"
            exit 1
          fi

      - name: ä¸‹è½½é¢„ç¼–è¯‘ iPXE EFI / Download Pre-compiled iPXE EFI
        run: |
          echo "ğŸ“¥ ä¸‹è½½é¢„ç¼–è¯‘ iPXE EFIï¼ˆç”¨äºå¤šè·¯å¾„é›†æˆæµ‹è¯•ï¼‰"
          
          # åˆ›å»º iPXE ç›®å½•
          mkdir -p ipxe_files
          cd ipxe_files
          
          # ä¸‹è½½å®˜æ–¹é¢„ç¼–è¯‘ iPXE EFI æ–‡ä»¶
          echo "ğŸ“¥ ä» https://boot.ipxe.org/ ä¸‹è½½ ipxe.efi"
          wget -O ipxe-efi-x86_64.efi "https://boot.ipxe.org/ipxe.efi" || {
            echo "âŒ iPXE ä¸‹è½½å¤±è´¥ï¼Œå·¥ä½œæµç»ˆæ­¢"
            exit 1
          }
          
          # å¤åˆ¶åˆ°å·¥ä½œç›®å½•
          cp ipxe-efi-x86_64.efi ../ipxe_x64.efi
          echo "âœ… iPXE EFI ä¸‹è½½æˆåŠŸ"
          ls -lh ../ipxe_x64.efi
          echo "ğŸ“Š iPXE æ–‡ä»¶ä¿¡æ¯ï¼š"
          file ../ipxe_x64.efi
          
          cd ..

      - name: æ›¿æ¢è‡ªå®šä¹‰ Logo / Replace Custom Logo
        run: |
          if [ -f "coreboot_logo.bmp" ]; then
            cp coreboot_logo.bmp coreboot/Documentation/coreboot_logo.bmp
            echo "âœ… å·²æ›¿æ¢ä¸ºè‡ªå®šä¹‰ Logo"
          else
            echo "â„¹ï¸  ä½¿ç”¨é»˜è®¤ Logo"
          fi

      - name: ç¼–è¯‘ MrChromebox å›ºä»¶ / Build MrChromebox Firmware
        run: |
          mkdir -p roms
          echo "ğŸ“¦ ç¼–è¯‘ MrChromebox å›ºä»¶ï¼ˆç”¨äºå¤šè·¯å¾„é›†æˆæµ‹è¯•ï¼‰"
          
          # ä½¿ç”¨ MrChromebox æ ‡å‡†ç¼–è¯‘æµç¨‹
          docker run --rm --user root \
            -v ${{ github.workspace }}/coreboot:/home/coreboot/coreboot \
            -v ${{ github.workspace }}/roms:/home/coreboot/roms \
            -w /home/coreboot/coreboot \
            coreboot/coreboot-sdk:latest \
            bash -c "git config --global --add safe.directory /home/coreboot/coreboot && \
                     echo 'ğŸ”§ ä½¿ç”¨ MrChromebox build-uefi.sh ç¼–è¯‘ kaisa...' && \
                     ./build-uefi.sh kaisa && \
                     chmod 644 /home/coreboot/roms/*.rom && \
                     echo 'âœ… MrChromebox å›ºä»¶ç¼–è¯‘å®Œæˆ'"

      - name: å¤šè·¯å¾„ iPXE é›†æˆæµ‹è¯• / Multi-path iPXE Integration Test
        run: |
          echo "ğŸ”§ æ–¹æ¡ˆ6æ ¸å¿ƒï¼šå¤šè·¯å¾„ iPXE é›†æˆæµ‹è¯•"
          
          # æ£€æŸ¥ iPXE æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ ! -f "ipxe_x64.efi" ]; then
            echo "âŒ iPXE æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è¿›è¡Œé›†æˆæµ‹è¯•"
            exit 1
          fi
          
          echo "ğŸ“Š iPXE æ–‡ä»¶ä¿¡æ¯ï¼š"
          ls -lh ipxe_x64.efi
          
          # æ‰¾åˆ°ç”Ÿæˆçš„ ROM æ–‡ä»¶
          ROM_FILE=$(ls roms/coreboot_*.rom | head -1)
          if [ -z "$ROM_FILE" ]; then
            echo "âŒ æœªæ‰¾åˆ° ROM æ–‡ä»¶"
            exit 1
          fi
          
          echo "ğŸ“‹ ROM æ–‡ä»¶: $ROM_FILE"
          
          # åˆ›å»ºæµ‹è¯•ç»“æœç›®å½•
          mkdir -p integration_tests
          
          # ä½¿ç”¨ä¼˜åŒ–çš„é›†æˆç­–ç•¥ï¼šå•ä¸€æ¨èè·¯å¾„ï¼ŒæŒ‰å‹ç¼©ä¼˜å…ˆçº§æµ‹è¯•
          declare -a PATHS=("efi/ipxe/ipxe.efi")  # coreboot æ¨èè·¯å¾„
          declare -a COMPRESSIONS=("none" "lz4" "lzma")  # æŒ‰ä¼˜å…ˆçº§æ’åºï¼šæ— å‹ç¼© > LZ4 > LZMA
          
          # æµ‹è¯•ç»“æœè®°å½•
          echo "è·¯å¾„,å‹ç¼©æ–¹å¼,é›†æˆç»“æœ,æ–‡ä»¶å¤§å°,CBFSæ¡ç›®" > integration_tests/test_results.csv
          
          echo ""
          echo "ğŸ§ª å¼€å§‹ä¼˜åŒ–çš„ iPXE é›†æˆæµ‹è¯•..."
          echo "ğŸ“‹ æµ‹è¯•ç­–ç•¥ï¼šå•ä¸€æ¨èè·¯å¾„ efi/ipxe/ipxe.efi"
          echo "ğŸ“‹ å‹ç¼©ä¼˜å…ˆçº§ï¼šæ— å‹ç¼© > LZ4 > LZMA"
          
          # æµ‹è¯•æ¯ä¸ªè·¯å¾„å’Œå‹ç¼©æ–¹å¼çš„ç»„åˆ
          for path in "${PATHS[@]}"; do
            for compression in "${COMPRESSIONS[@]}"; do
              echo ""
              echo "ğŸ”§ æµ‹è¯•è·¯å¾„: $path, å‹ç¼©: $compression"
              
              # å¤åˆ¶åŸå§‹ ROM æ–‡ä»¶
              TEST_ROM="${ROM_FILE%.*}_${path//\//_}_${compression}.rom"
              cp "$ROM_FILE" "$TEST_ROM"
              
              # å°è¯•é›†æˆï¼ˆæ”¯æŒä¸‰ç§å‹ç¼©æ–¹å¼ï¼‰
              if [ "$compression" = "lzma" ]; then
                COMPRESS_FLAG="-c lzma"
              elif [ "$compression" = "lz4" ]; then
                COMPRESS_FLAG="-c lz4"
              else
                COMPRESS_FLAG=""  # æ— å‹ç¼©
              fi
              
              # æ‰§è¡Œé›†æˆå‘½ä»¤
              if coreboot/build/cbfstool "$TEST_ROM" add -f ipxe_x64.efi -n "$path" -t raw $COMPRESS_FLAG 2>/dev/null; then
                echo "âœ… é›†æˆæˆåŠŸ"
                RESULT="æˆåŠŸ"
                
                # æ£€æŸ¥ CBFS æ¡ç›®
                CBFS_ENTRY=$(coreboot/build/cbfstool "$TEST_ROM" print | grep "$path" | head -1)
                
                # è®°å½•åˆ° CSV
                echo "$path,$compression,æˆåŠŸ,$(ls -lh "$TEST_ROM" | awk '{print $5}'),\"$CBFS_ENTRY\"" >> integration_tests/test_results.csv
                
                # ä¿å­˜æˆåŠŸçš„ ROM æ–‡ä»¶
                cp "$TEST_ROM" "roms/"
              else
                echo "âŒ é›†æˆå¤±è´¥"
                RESULT="å¤±è´¥"
                
                # è®°å½•åˆ° CSV
                echo "$path,$compression,å¤±è´¥,N/A,N/A" >> integration_tests/test_results.csv
                
                # åˆ é™¤å¤±è´¥çš„ ROM æ–‡ä»¶
                rm -f "$TEST_ROM"
              fi
            done
          done
          
          echo ""
          echo "ğŸ“Š é›†æˆæµ‹è¯•ç»“æœæ±‡æ€»ï¼š"
          cat integration_tests/test_results.csv
          
          # ç»Ÿè®¡æˆåŠŸæ•°é‡
          SUCCESS_COUNT=$(grep -c "æˆåŠŸ" integration_tests/test_results.csv)
          TOTAL_TESTS=$((${#PATHS[@]} * ${#COMPRESSIONS[@]}))
          
          echo ""
          echo "ğŸ“ˆ æµ‹è¯•ç»Ÿè®¡ï¼š"
          echo "  æ€»æµ‹è¯•æ•°: $TOTAL_TESTS"
          echo "  æˆåŠŸæ•°: $SUCCESS_COUNT"
          echo "  æˆåŠŸç‡: $(( SUCCESS_COUNT * 100 / TOTAL_TESTS ))%"

      - name: åˆ†ææœ€ä½³é›†æˆæ–¹å¼ / Analyze Best Integration Method
        run: |
          echo "ğŸ” åˆ†ææœ€ä½³é›†æˆæ–¹å¼"
          
          # æ£€æŸ¥æˆåŠŸçš„é›†æˆ
          SUCCESSFUL_TESTS=$(grep "æˆåŠŸ" integration_tests/test_results.csv)
          
          if [ -n "$SUCCESSFUL_TESTS" ]; then
            echo "âœ… æ‰¾åˆ°æˆåŠŸçš„é›†æˆæ–¹å¼ï¼š"
            echo "$SUCCESSFUL_TESTS"
            
            # æ¨èæœ€ä½³æ–¹å¼
            echo ""
            echo "ğŸ¯ æ¨èçš„æœ€ä½³é›†æˆæ–¹å¼ï¼š"
            
            # ä¼˜å…ˆæ¨èæ ‡å‡† UEFI è·¯å¾„
            if echo "$SUCCESSFUL_TESTS" | grep -q "efi/boot/bootx64.efi"; then
              BEST_PATH="efi/boot/bootx64.efi"
              echo "  ğŸ¥‡ é¦–é€‰ï¼š$BEST_PATHï¼ˆæ ‡å‡† UEFI å¯åŠ¨è·¯å¾„ï¼‰"
            elif echo "$SUCCESSFUL_TESTS" | grep -q "efi/boot/ipxe.efi"; then
              BEST_PATH="efi/boot/ipxe.efi"
              echo "  ğŸ¥ˆ å¤‡é€‰ï¼š$BEST_PATHï¼ˆè‡ªå®šä¹‰ iPXE è·¯å¾„ï¼‰"
            elif echo "$SUCCESSFUL_TESTS" | grep -q "efi/ipxe/ipxe.efi"; then
              BEST_PATH="efi/ipxe/ipxe.efi"
              echo "  ğŸ¥‰ å¤‡é€‰ï¼š$BEST_PATHï¼ˆiPXE ä¸“ç”¨è·¯å¾„ï¼‰"
            else
              BEST_PATH=$(echo "$SUCCESSFUL_TESTS" | head -1 | cut -d',' -f1)
              echo "  ğŸ”§ å¯ç”¨ï¼š$BEST_PATH"
            fi
            
            # æ¨èå‹ç¼©æ–¹å¼
            if echo "$SUCCESSFUL_TESTS" | grep -q "$BEST_PATH.*lzma"; then
              echo "  ğŸ“¦ æ¨èå‹ç¼©ï¼šLZMAï¼ˆèŠ‚çœç©ºé—´ï¼‰"
            else
              echo "  ğŸ“¦ æ¨èå‹ç¼©ï¼šæ— å‹ç¼©ï¼ˆå¯åŠ¨æ›´å¿«ï¼‰"
            fi
            
          else
            echo "âŒ æ‰€æœ‰é›†æˆæ–¹å¼éƒ½å¤±è´¥"
            echo "  - å¯èƒ½éœ€è¦æ£€æŸ¥ CBFS ç©ºé—´"
            echo "  - æˆ–è€… iPXE æ–‡ä»¶è¿‡å¤§"
            echo "  - å»ºè®®ä½¿ç”¨æ›´å°çš„ iPXE ç‰ˆæœ¬"
          fi

      - name: ç”Ÿæˆæ–¹æ¡ˆ6æµ‹è¯•æŠ¥å‘Š / Generate Strategy 6 Test Report
        run: |
          echo "ğŸ“Š ç”Ÿæˆæ–¹æ¡ˆ6æµ‹è¯•æŠ¥å‘Š"
          mkdir -p test-reports
          
          ROM_FILE=$(ls roms/coreboot_*.rom | head -1)
          SUCCESS_COUNT=$(grep -c "æˆåŠŸ" integration_tests/test_results.csv)
          TOTAL_TESTS=$(($(grep -c "," integration_tests/test_results.csv) - 1))
          
          cat > test-reports/strategy6-test-report.md << EOF
          # æ–¹æ¡ˆ6æµ‹è¯•æŠ¥å‘Š - å¤šè·¯å¾„ iPXE é›†æˆ
          
          **æµ‹è¯•æ—¶é—´**: $(date)
          **GitHub Actions Run**: ${{ github.run_number }}
          **MrChromebox ç‰ˆæœ¬**: $(cd coreboot && git rev-parse HEAD)
          
          ## æ–¹æ¡ˆè¯´æ˜
          
          - **æ–¹æ¡ˆåç§°**: æ–¹æ¡ˆ6 - å¤šè·¯å¾„ iPXE é›†æˆ
          - **æŠ€æœ¯è·¯çº¿**: å°è¯•å¤šç§ CBFS è·¯å¾„å’Œå‹ç¼©æ–¹å¼
          - **é€‚ç”¨åœºæ™¯**: ä¼˜åŒ– iPXE é›†æˆæ•ˆæœï¼Œæ‰¾åˆ°æœ€ä½³æ–¹æ¡ˆ
          
          ## æµ‹è¯•ç»“æœ
          
          ### é›†æˆæµ‹è¯•ç»Ÿè®¡
          - æ€»æµ‹è¯•æ•°: $TOTAL_TESTS
          - æˆåŠŸæ•°: $SUCCESS_COUNT
          - æˆåŠŸç‡: $(( SUCCESS_COUNT * 100 / TOTAL_TESTS ))%
          
          ### è¯¦ç»†æµ‹è¯•ç»“æœ
          
          \`\`\`csv
          $(cat integration_tests/test_results.csv)
          \`\`\`
          
          ### æœ€ä½³é›†æˆæ–¹å¼
          
          $(if [ $SUCCESS_COUNT -gt 0 ]; then
            echo "âœ… **æ‰¾åˆ°æˆåŠŸçš„é›†æˆæ–¹å¼**"
            echo ""
            echo "**æ¨èé…ç½®ï¼š**"
            BEST_TEST=$(grep "æˆåŠŸ" integration_tests/test_results.csv | head -1)
            BEST_PATH=$(echo "$BEST_TEST" | cut -d',' -f1)
            BEST_COMPRESSION=$(echo "$BEST_TEST" | cut -d',' -f2)
            echo "- è·¯å¾„: $BEST_PATH"
            echo "- å‹ç¼©: $BEST_COMPRESSION"
            echo "- æ–‡ä»¶å¤§å°: $(echo "$BEST_TEST" | cut -d',' -f4)"
          else
            echo "âŒ **æ‰€æœ‰é›†æˆæ–¹å¼éƒ½å¤±è´¥**"
            echo ""
            echo "**é—®é¢˜åˆ†æï¼š**"
            echo "- å¯èƒ½éœ€è¦æ£€æŸ¥ CBFS ç©ºé—´"
            echo "- æˆ–è€… iPXE æ–‡ä»¶è¿‡å¤§"
            echo "- å»ºè®®ä½¿ç”¨æ›´å°çš„ iPXE ç‰ˆæœ¬"
          fi)
          
          ## ç»“è®º
          
          $(if [ $SUCCESS_COUNT -gt 0 ]; then
            echo "âœ… **æ–¹æ¡ˆ6æµ‹è¯•æˆåŠŸ**"
            echo ""
            echo "- æ‰¾åˆ° $SUCCESS_COUNT ç§å¯ç”¨çš„é›†æˆæ–¹å¼"
            echo "- å¯ä»¥ä¼˜åŒ– iPXE é›†æˆæ•ˆæœ"
            echo "- æä¾›äº†å¤šç§å¤‡é€‰æ–¹æ¡ˆ"
          else
            echo "âŒ **æ–¹æ¡ˆ6æµ‹è¯•å¤±è´¥**"
            echo ""
            echo "- æ‰€æœ‰é›†æˆæ–¹å¼éƒ½å¤±è´¥"
            echo "- éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–"
          fi)
          
          ## ä¸‹ä¸€æ­¥å»ºè®®
          
          - ä½¿ç”¨æ¨èçš„é›†æˆæ–¹å¼æ›´æ–°æ–¹æ¡ˆ1
          - åœ¨å®é™…ç¡¬ä»¶ä¸Šæµ‹è¯•ä¸åŒè·¯å¾„çš„å¯åŠ¨æ•ˆæœ
          - å¯¹æ¯”ä¸åŒå‹ç¼©æ–¹å¼çš„æ€§èƒ½å·®å¼‚
          EOF
          
          cat test-reports/strategy6-test-report.md

      - name: ä¸Šä¼ å›ºä»¶ / Upload Firmware Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: strategy6-firmware-${{ github.run_number }}
          path: roms/*.rom
          retention-days: 30

      - name: ä¸Šä¼ æµ‹è¯•ç»“æœ / Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: strategy6-test-results-${{ github.run_number }}
          path: integration_tests/
          retention-days: 30

      - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š / Upload Test Report
        uses: actions/upload-artifact@v4
        with:
          name: strategy6-test-report-${{ github.run_number }}
          path: test-reports/
          retention-days: 30

      - name: åˆ›å»º Release / Create Release
        if: ${{ inputs.release == true }}
        uses: softprops/action-gh-release@v1
        with:
          tag_name: strategy6-firmware-${{ github.run_number }}
          name: æ–¹æ¡ˆ6å›ºä»¶ - å¤šè·¯å¾„ iPXE é›†æˆ / Strategy 6 - Multi-path iPXE Integration
          body: |
            ## æ–¹æ¡ˆ6ï¼šå¤šè·¯å¾„ iPXE é›†æˆ
            
            **è®¾å¤‡ / Device:** Acer Chromebox CXI4 (kaisa)
            **æ–¹æ¡ˆ / Strategy:** æ–¹æ¡ˆ6 - å¤šè·¯å¾„ iPXE é›†æˆ
            **æ„å»ºæ—¥æœŸ / Build Date:** ${{ github.run_number }}
            
            ### æ–¹æ¡ˆè¯´æ˜
            
            - **æŠ€æœ¯è·¯çº¿**: å°è¯•å¤šç§ CBFS è·¯å¾„å’Œå‹ç¼©æ–¹å¼
            - **ç½‘ç»œæ”¯æŒ**: EDK2 åŸç”Ÿ + iPXE å¢å¼º
            - **é›†æˆæ–¹å¼**: å¤šè·¯å¾„æµ‹è¯•ï¼Œæ‰¾åˆ°æœ€ä½³æ–¹æ¡ˆ
            
            ### æµ‹è¯•ç»“æœ
            
            - æ€»æµ‹è¯•æ•°: $(grep -c "," integration_tests/test_results.csv || echo "0")
            - æˆåŠŸæ•°: $(grep -c "æˆåŠŸ" integration_tests/test_results.csv || echo "0")
            - æˆåŠŸç‡: $(( $(grep -c "æˆåŠŸ" integration_tests/test_results.csv || echo "0") * 100 / $(grep -c "," integration_tests/test_results.csv || echo "1") ))%
            
            ### æ–‡ä»¶æ¸…å•
            
            - å›ºä»¶æ–‡ä»¶ï¼šå¤šä¸ªæµ‹è¯•ç‰ˆæœ¬çš„ ROM æ–‡ä»¶
            - æµ‹è¯•ç»“æœï¼š`test_results.csv`
            - æµ‹è¯•æŠ¥å‘Šï¼š`strategy6-test-report.md`
            
          files: |
            roms/*.rom
            integration_tests/*.csv
            test-reports/*.md
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
